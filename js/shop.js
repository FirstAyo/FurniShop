document.addEventListener("DOMContentLoaded", async () => { const grid = document.getElementById("product-grid"); const filterCategory = document.getElementById("filter-category"); const sortSelect = document.getElementById("sort-by"); try { const products = await getProducts(); const categories = [...new Set(products.map(p => p.category))].sort(); categories.forEach(c => { const opt = document.createElement("option"); opt.value = c; opt.textContent = c; filterCategory.appendChild(opt); }); function render(list) { grid.innerHTML = ""; list.forEach(p => { const card = document.createElement("article"); card.className = "card"; card.innerHTML = ` <img src="${p.images[0]}" alt="${p.name}"> <div class="p-16"> <h3><a href="product.html?id=${p.id}">${p.name}</a></h3> <div class="price">${Shop.money(p.price)}</div> <div style="display:flex;justify-content:space-between;align-items:center;margin-top:.6rem;"> <span class="badge">${p.category}</span> <button class="icon-btn add" data-id="${p.id}">Add</button> </div> </div>`; grid.appendChild(card); }); grid.querySelectorAll(".add").forEach(btn => { btn.addEventListener("click", () => { const p = products.find(x => x.id === Number(btn.dataset.id)); Shop.addToCart({id:p.id, price:p.price, name:p.name, qty:1}); btn.textContent = "Added âœ“"; setTimeout(()=>btn.textContent="Add", 1000); }); }); } function apply() { let list = [...products]; const cat = filterCategory.value; if (cat) list = list.filter(p => p.category === cat); const sort = sortSelect.value; if (sort === "price-asc") list.sort((a,b)=>a.price-b.price); if (sort === "price-desc") list.sort((a,b)=>b.price-a.price); render(list); } filterCategory.addEventListener("change", apply); sortSelect.addEventListener("change", apply); render(products); } catch (e) { grid.innerHTML = `<div class="alert">${e.message}</div>`; } });